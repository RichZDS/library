# BTreeAuthor 类函数详解

`BTreeAuthor` 类使用 B 树结构，以作者名作为键，存储该作者的所有图书 ID 列表。这是一个**倒排索引**（Inverted Index）的实现。

## 节点结构

```cpp
struct BTreeAuthorNode {
    bool leaf;                          // 是否为叶子节点
    vector<string> keys;                // 作者名列表（有序）
    vector<vector<string>> ids;         // 每个作者对应的图书 ID 列表
    vector<BTreeAuthorNode*> children;  // 子节点指针列表
};
```

**注意**：与 `BTreeBookNode` 不同，这里每个键对应的是一个 `vector<string>`（图书 ID 列表），而不是单个记录。这样设计是为了支持一个作者有多本图书的情况。

---

## 构造函数和析构函数

### `BTreeAuthor(int t = 2)`

**功能**：创建作者索引 B 树

**参数**：
- `t`：最小度数，默认为 2

---

### `~BTreeAuthor()`

**功能**：析构函数，释放整个 B 树的内存

---

## 查找函数

### `int findKeyIndex(BTreeAuthorNode* x, const string& key) const`

**功能**：在当前节点中查找键的位置

**参数**：
- `x`：当前节点
- `key`：要查找的作者名

**返回值**：第一个大于等于 `key` 的键的索引

**说明**：这是一个辅助函数，用于定位键的位置

---

### `BTreeAuthorNode* searchNode(BTreeAuthorNode* x, const string& author, int& idx) const`

**功能**：搜索包含指定作者的节点

**参数**：
- `x`：当前搜索的节点
- `author`：要查找的作者名
- `idx`：输出参数，返回键在节点中的索引

**返回值**：
- 找到：返回包含该作者的节点指针
- 未找到：返回 `nullptr`

**说明**：这是作者搜索的核心递归函数

---

## 插入操作

### `void add(const string& author, const string& id)`

**功能**：添加作者-图书 ID 的关联

**参数**：
- `author`：作者名
- `id`：图书 ID

**算法流程**：
1. 如果树为空，创建根节点并插入
2. 查找作者是否已存在：
   - **如果存在**：将图书 ID 添加到该作者的 ID 列表中（避免重复）
   - **如果不存在**：插入新作者节点

**示例**：
```cpp
authorIndex.add("王小明", "B001");
authorIndex.add("王小明", "B002");  // 同一作者的第二本书
```

---

### `void insertNonFull(BTreeAuthorNode* x, const string& author, const string& id)`

**功能**：在非满节点中插入新的作者-图书 ID 关联

**说明**：与 `BTreeBook::insertNonFull()` 类似，但处理的是作者名和 ID 列表

---

### `void splitChild(BTreeAuthorNode* x, int i)`

**功能**：分裂已满的子节点

**说明**：与 `BTreeBook::splitChild()` 类似，但需要同时处理键和 ID 列表

---

## 删除操作

### `void removePair(const string& author, const string& id)`

**功能**：删除作者-图书 ID 的关联

**参数**：
- `author`：作者名
- `id`：要删除的图书 ID

**算法流程**：
1. 查找包含该作者的节点
2. 从该作者的 ID 列表中删除指定的 ID
3. 如果删除后 ID 列表为空，从 B 树中删除该作者节点（使用重建法）

**示例**：
```cpp
authorIndex.removePair("王小明", "B001");
```

---

## 查询操作

### `vector<string> getIds(const string& author) const`

**功能**：根据作者名获取该作者的所有图书 ID 列表

**参数**：
- `author`：作者名

**返回值**：图书 ID 列表，如果作者不存在返回空列表

**时间复杂度**：O(log n)

**示例**：
```cpp
vector<string> bookIds = authorIndex.getIds("王小明");
for (const auto& id : bookIds) {
    // 使用 bookIds 在 BTreeBook 中查找对应的图书
}
```

---

## 辅助函数

### `void inorderAuthors(BTreeAuthorNode* x, vector<pair<string, vector<string>>>& out) const`

**功能**：中序遍历，收集所有作者及其图书 ID 列表

**说明**：用于重建树或查询所有数据

---

### `void destroy(BTreeAuthorNode* x)`

**功能**：递归销毁 B 树节点
