# B树结构展示功能使用说明

## 📋 功能概述

新增了**B树结构（凹入表）**展示功能，可以直观地查看当前B树的层级结构。

## 🎯 使用方法

### 1. 启动服务器

运行编译好的C++服务器程序：

```bash
.\build\Release\library_web.exe
```

服务器将在 `http://localhost:8000` 启动。

### 2. 打开前端界面

在浏览器中访问：`http://localhost:8000`

### 3. 查看B树结构

1. 在图书列表页面，点击 **"查看B树结构"** 按钮
2. 系统会以弹窗形式显示当前B树的凹入表结构

## 📊 凹入表格式说明

### 显示格式

```
[ Root ]                    ← 根节点（紫色边框）
    [ B001 ] (leaf)         ← 第一层子节点（蓝色边框）
    [ B002 B003 ] (leaf)    ← 第一层子节点，包含2个键
    [ B004 ] (leaf)         ← 第一层子节点（绿色边框，叶子节点）
```

### 颜色说明

- **紫色边框**：根节点
- **蓝色边框**：内部节点（非叶子节点）
- **绿色边框**：叶子节点

### 缩进规则

- 每4个空格表示一层
- 根节点无缩进
- 子节点缩进4个空格
- 孙节点缩进8个空格
- 以此类推

## 🔧 技术实现

### 前端实现

- **位置**：`webroot/index.html` 和 `webroot/app.js`
- **函数**：`viewTree()` - 调用API获取B树结构并显示

### 后端实现

- **位置**：`web/BookController.cpp` 和 `web/BookService.cpp`
- **API端点**：`GET /tree`
- **功能**：调用 `BTreeBook::getStructure()` 获取B树凹入表字符串

### C++实现

- **函数**：`BTreeBook::getStructure()` - 获取B树凹入表字符串
- **函数**：`BTreeBook::getStructureNode()` - 递归生成凹入表

## 📝 凹入表生成原理

### 算法步骤

1. **从根节点开始**，深度为0
2. **打印当前节点**：
   - 打印缩进（depth × 4个空格）
   - 打印节点键值：`[ Key1 Key2 ... ]`
   - 如果是叶子节点，标记 `(leaf)`
3. **递归打印子节点**：
   - 深度+1
   - 对每个子节点重复步骤2

### 代码示例

```cpp
void BTreeBook::getStructureNode(BTreeBookNode* x, int depth, stringstream& ss) const {
    // 1. 打印缩进
    for (int i = 0; i < depth; ++i) {
        ss << "    ";  // 4个空格
    }
    
    // 2. 打印节点键值
    ss << "[ ";
    for (const auto& k : x->keys) {
        ss << k << " ";
    }
    ss << "]";
    
    // 3. 标记叶子节点
    if (x->leaf) {
        ss << " (leaf)";
    }
    ss << endl;
    
    // 4. 递归打印子节点
    if (!x->leaf) {
        for (auto c : x->children) {
            getStructureNode(c, depth + 1, ss);
        }
    }
}
```

## 🎨 显示特性

1. **文本格式**：清晰的缩进层级
2. **节点标记**：叶子节点标记为 `(leaf)`
3. **方括号格式**：`[ Key1 Key2 ... ]` 格式显示节点键值

## 💡 使用建议

1. **添加图书后**：点击"刷新结构"查看B树变化
2. **插入操作**：观察节点分裂过程
3. **删除操作**：观察树的重建过程
4. **答辩演示**：可以实时展示B树结构变化

## 🐛 故障排除

### 问题1：显示"获取B树结构失败"

**原因**：C++程序可能不支持`tree`命令

**解决**：
- 检查C++程序是否已编译
- 确认程序支持`tree`命令
- 系统会自动使用简化表示

### 问题2：显示为空

**原因**：B树中没有数据

**解决**：先添加一些图书，然后再查看结构

### 问题3：结构显示不正确

**原因**：可能是API返回格式问题

**解决**：
- 检查浏览器控制台的错误信息
- 确认后端API正常工作
- 查看`web/BookController.hpp`中的`/tree`端点

## 📚 相关文档

- **学习指南**：`B树学习指南.md` - 详细的B树算法说明
- **代码注释**：`datastruct/btree_book.cpp` - 包含详细的中文注释

---

**祝你答辩顺利！** 🎉

